<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Luy·ªán N√≥i Ti·∫øng ƒê·ª©c Pro ‚Äî Popup Google D·ªãch</title>
  <style>
    :root { --primary:#0d6efd; --accent:#ffc107; --ok:#198754; --error:#dc3545; }
    *{ box-sizing:border-box }
    body{
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background:#f0f2f5; color:#1c1e21; margin:0; padding:24px;
      display:flex; justify-content:center; align-items:flex-start; min-height:100vh;
    }
    .container{
      width:100%; max-width:760px; background:#fff; border-radius:14px; padding:28px;
      box-shadow:0 6px 18px rgba(0,0,0,.08);
    }
    h1{ margin:0 0 16px; color:var(--primary); }
    h2{ font-size:1.1rem; color:#495057; margin:22px 0 8px; border-bottom:1px solid #e9ecef; padding-bottom:6px;}
    textarea{
      width:100%; padding:12px; border:1px solid #ced4da; border-radius:10px; font-size:1rem; resize:vertical;
    }
    .controls,.session-controls{ display:flex; gap:10px; flex-wrap:wrap; margin:14px 0; }
    button{
      border:0; background:var(--primary); color:#fff; padding:10px 18px; border-radius:9px;
      font-weight:600; cursor:pointer; transition:.2s; box-shadow:0 2px 5px rgba(0,0,0,.08);
    }
    button:hover{ transform:translateY(-1px); filter:brightness(0.95); }
    button.secondary{ background:#6c757d; }
    button.success{ background:var(--ok); }
    button.warning{ background:#fd7e14; }
    button.info{ background:#0dcaf0; }
    button.ghost{ background:#e9ecef; color:#333; }
    button:disabled{ opacity:.6; cursor:not-allowed; transform:none; }
    .dialogue-box{ background:#f8f9fa; border:1px solid #e9ecef; border-radius:10px; padding:14px; }
    .line{ padding:10px; margin:8px 0; border-radius:10px; font-size:1.05rem; }
    .computer-line{ background:#e7f3ff; }
    .user-line{ background:#fff3cd; font-weight:600; border:2px dashed var(--accent); }
    .status{ margin-top:14px; font-weight:700; padding:12px; border-radius:10px; min-height:48px; }
    .status.success{ background:#d1e7dd; color:#146c43; }
    .status.error{ background:#f8d7da; color:#b02a37; }
    .status.neutral{ background:#eef; color:#334; }
    .instructions{ background:#eef; padding:14px; border-radius:10px; border-left:4px solid var(--primary); color:#555; }
    .feedback-box{
      font-size:1rem; background:#f8f9fa; border:1px solid #ddd; border-radius:10px; padding:14px; line-height:1.7; margin-top:10px;
    }
    .diff-correct{ color:#000; }
    .diff-incorrect{ color:#dc3545; font-weight:700; text-decoration:underline; }
    .diff-missing{ color:#6c757d; font-style:italic; }
    #score-area{
      position:fixed; top:18px; right:18px; background:var(--accent); color:#333;
      padding:8px 14px; border-radius:20px; font-weight:800; box-shadow:0 2px 6px rgba(0,0,0,.12);
    }
    #danh-sach-hoi-thoai{ text-align:left; background:#f8f9fa; border:1px solid #dee2e6; border-radius:10px; padding:16px; margin-bottom:18px; }
    .file-button{ background:var(--primary); padding:8px 13px; border-radius:8px; color:#fff; margin:4px; font-size:.95rem; }
  </style>
</head>
<body>
<div id="score-area">ƒêi·ªÉm: 100</div>
<div class="container">
  <h1>Luy·ªán Giao Ti·∫øp Chuy√™n Nghi·ªáp üöÄ</h1>

  <div id="danh-sach-hoi-thoai"></div>

  <div id="initial-setup">
    <div class="instructions">
      <b>H∆∞·ªõng d·∫´n:</b>
      <ol>
        <li>Ch·ªçn h·ªôi tho·∫°i c√≥ s·∫µn ho·∫∑c d√°n h·ªôi tho·∫°i c·ªßa b·∫°n v√†o √¥ b√™n d∆∞·ªõi (d√≤ng ph·∫£i b·∫Øt ƒë·∫ßu b·∫±ng <code>A:</code> ho·∫∑c <code>B:</code>).</li>
        <li>Nh·∫•n <b>B·∫Øt ƒê·∫ßu Luy·ªán T·∫≠p</b>. Khi ƒë·∫øn l∆∞·ª£t b·∫°n, h·ªá th·ªëng m·ªü <b>popup Google D·ªãch (ƒê·ª©c ‚Üí Vi·ªát)</b>.</li>
        <li>Trong popup, b·∫•m <b>M·ªü Google D·ªãch</b> ‚Üí nh·∫•n bi·ªÉu t∆∞·ª£ng <b>micro</b> v√† n√≥i.</li>
        <li>Sao ch√©p ƒëo·∫°n ti·∫øng ƒê·ª©c b·∫°n v·ª´a n√≥i (√¥ b√™n tr√°i c·ªßa Google D·ªãch) ‚Üí quay l·∫°i popup, b·∫•m <b>L·∫•y t·ª´ Clipboard & G·ª≠i</b> ƒë·ªÉ ch·∫•m ƒëi·ªÉm t·ª± ƒë·ªông.</li>
      </ol>
      <div style="margin-top:8px; font-size:.95rem; color:#6c757d">
        *Do gi·ªõi h·∫°n b·∫£o m·∫≠t tr√¨nh duy·ªát, trang kh√¥ng th·ªÉ ƒë·ªçc tr·ª±c ti·∫øp n·ªôi dung tr√™n translate.google.com, n√™n c·∫ßn m·ªôt c√∫ nh·∫•p ƒë·ªÉ l·∫•y t·ª´ Clipboard.
      </div>
    </div>

    <textarea id="dialogue-input" rows="6" placeholder="D√°n h·ªôi tho·∫°i ·ªü ƒë√¢y...
V√≠ d·ª•:
A: Hallo, wie geht's?
B: Mir geht's gut, danke."></textarea>

    <div class="controls">
      <button id="load-btn">üöÄ B·∫Øt ƒê·∫ßu Luy·ªán T·∫≠p</button>
      <button id="swap-roles-btn" class="ghost">üîÅ ƒê·ªïi Vai (Hi·ªán t·∫°i: B·∫°n l√† B)</button>
      <button id="toggle-line-btn" class="ghost" disabled>üôà Hi·ªán L·ªùi Tho·∫°i</button>
    </div>
  </div>

  <div id="practice-area" class="dialogue-box" style="display:none;">
    <h2>L·ªùi tho·∫°i c·ªßa m√°y:</h2>
    <div id="computer-line" class="line computer-line">...</div>
    <div>
      <h2 id="user-line-title">C√¢u c·ªßa b·∫°n:</h2>
      <div id="user-line" class="line user-line" style="display:none;">...</div>
    </div>
  </div>

  <div id="status-area" class="status neutral"></div>

  <div id="review-area" style="display:none;">
    <h2>Xem L·∫°i H·ªôi Tho·∫°i</h2>
    <div id="review-content"></div>
    <div class="controls" style="margin-top: 10px;">
      <button id="restart-session-btn" class="success">üîÅ Luy·ªán l·∫°i h·ªôi tho·∫°i n√†y</button>
      <button id="choose-new-btn" class="secondary">üè† Ch·ªçn h·ªôi tho·∫°i kh√°c</button>
    </div>
  </div>
</div>

<script>
/* =====================
   TI·ªÜN √çCH & CH·∫§M ƒêI·ªÇM
   ===================== */
function lcs(seq1, seq2){
  const m=seq1.length,n=seq2.length;
  const dp=Array.from({length:m+1},()=>Array(n+1).fill(0));
  for(let i=1;i<=m;i++){
    for(let j=1;j<=n;j++){
      dp[i][j]=seq1[i-1]===seq2[j-1]?dp[i-1][j-1]+1:Math.max(dp[i-1][j],dp[i][j-1]);
    }
  }
  let i=m,j=n,res=[];
  while(i>0&&j>0){
    if(seq1[i-1]===seq2[j-1]){ res.unshift(seq1[i-1]); i--; j--; }
    else if(dp[i-1][j]>dp[i][j-1]) i--; else j--;
  }
  return res;
}
function createDiffHtml(originalText, spokenText){
  const clean=t=>t.toLowerCase().replace(/[^\w\s'√§√∂√º√ü]/g,'').split(/\s+/).filter(Boolean);
  const original=clean(originalText), spoken=clean(spokenText);
  const common=new Set(lcs(original,spoken));
  let correct=0;
  const spokenHtml=spoken.map(w=>{
    if(common.has(w)){ correct++; return `<span class="diff-correct">${w}</span>`; }
    return `<span class="diff-incorrect">${w}</span>`;
  }).join(' ');
  const originalHtml=original.map(w=> common.has(w) ? `<span class="diff-correct">${w}</span>` : `<span class="diff-missing">${w}</span>`).join(' ');
  const accuracy = original.length ? Math.round((correct/original.length)*100) : 0;
  return { html:`<div><b>C√¢u g·ªëc:</b> ${originalHtml}</div><div><b>B·∫°n n√≥i:</b> ${spokenHtml}</div>`, accuracy };
}

/* =====================
   BI·∫æN TR·∫†NG TH√ÅI & UI
   ===================== */
const scoreArea = document.getElementById('score-area');
const statusArea = document.getElementById('status-area');
const dialogueInput = document.getElementById('dialogue-input');
const loadBtn = document.getElementById('load-btn');
const swapRolesBtn = document.getElementById('swap-roles-btn');
const toggleBtn = document.getElementById('toggle-line-btn');

const practiceArea = document.getElementById('practice-area');
const computerLineEl = document.getElementById('computer-line');
const userLineEl = document.getElementById('user-line');
const userLineTitle = document.getElementById('user-line-title');

const reviewArea = document.getElementById('review-area');
const reviewContent = document.getElementById('review-content');
const restartSessionBtn = document.getElementById('restart-session-btn');
const chooseNewBtn = document.getElementById('choose-new-btn');

let linesA=[], linesB=[], currentLineIndex=0, userIsB=true, isUserLineVisible=false;
let score=100;

/* =====================
   GI·ªåNG ƒê·ªåC (m√°y n√≥i)
   ===================== */
const synth = window.speechSynthesis;
let voices=[];
function loadVoices(){ voices = synth.getVoices(); }
loadVoices(); if(synth.onvoiceschanged !== undefined){ synth.onvoiceschanged = loadVoices; }
function speak(text, cb){
  if(synth.speaking) synth.cancel();
  const u = new SpeechSynthesisUtterance(text);
  u.voice = voices.find(v=>v.name==='Microsoft Amala Online (Natural) - German (Germany)') || voices.find(v=>v.lang?.startsWith('de'));
  u.onend = ()=> cb && cb();
  synth.speak(u);
}

/* =====================
   GOOGLE D·ªäCH POPUP
   - Kh√¥ng d√πng SpeechRecognition
   - D√πng window.open + postMessage + Clipboard
   ===================== */
function openTranslatePopup(){
  const popupHtml = `<!doctype html>
  <html lang="vi"><head><meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Google D·ªãch (ƒê·ª©c ‚Üí Vi·ªát)</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;margin:0;padding:16px;background:#f7f7fb;color:#222}
    .box{background:#fff;border:1px solid #e5e7eb;border-radius:12px;max-width:560px;margin:0 auto;padding:16px;box-shadow:0 4px 14px rgba(0,0,0,.06)}
    h1{font-size:1.1rem;margin:0 0 8px;color:#0d6efd}
    p{margin:8px 0}
    .row{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    button,a.btn{background:#0d6efd;color:#fff;border:0;border-radius:10px;padding:10px 14px;font-weight:700;text-decoration:none;display:inline-block}
    button.secondary{background:#6c757d}
    .tip{font-size:.9rem;color:#555;background:#eef;padding:10px;border-radius:8px;margin-top:10px}
  </style></head>
  <body>
    <div class="box">
      <h1>Google D·ªãch ‚Äî Nh·∫≠n Transcript (DE ‚Üí VI)</h1>
      <p>1) Nh·∫•n <b>M·ªü Google D·ªãch</b> ‚Üí b·∫•m bi·ªÉu t∆∞·ª£ng <b>micro</b> v√† n√≥i b·∫±ng ti·∫øng ƒê·ª©c.</p>
      <p>2) Ch·ªçn & Sao ch√©p ƒëo·∫°n ti·∫øng ƒê·ª©c v·ª´a n√≥i (√¥ b√™n tr√°i).</p>
      <p>3) Quay l·∫°i c·ª≠a s·ªï n√†y v√† b·∫•m <b>L·∫•y t·ª´ Clipboard & G·ª≠i</b>.</p>
      <div class="row">
        <a class="btn" target="_blank" rel="noopener" href="https://translate.google.com/?sl=de&tl=vi&op=translate">üåê M·ªü Google D·ªãch</a>
        <button id="pasteSendBtn">üìã L·∫•y t·ª´ Clipboard & G·ª≠i</button>
        <button id="closeBtn" class="secondary">ƒê√≥ng</button>
      </div>
      <div class="tip">M·∫πo: Nh·∫•n <b>Ctrl/Cmd + C</b> b·∫£n ti·∫øng ƒê·ª©c xong h√£y quay l·∫°i ƒë√¢y.</div>
    </div>
    <script>
      const openerOrigin = "*"; // C√≥ th·ªÉ ƒë·ªïi sang origin c·ª• th·ªÉ n·∫øu b·∫°n ch·∫°y tr√™n web server.
      document.getElementById('pasteSendBtn').addEventListener('click', async () => {
        try{
          const text = await navigator.clipboard.readText();
          if(!text || !text.trim()){ alert('Clipboard tr·ªëng. H√£y sao ch√©p ƒëo·∫°n TI·∫æNG ƒê·ª®C ·ªü √¥ tr√°i c·ªßa Google D·ªãch tr∆∞·ªõc.'); return; }
          window.opener && window.opener.postMessage({type:'GT_TRANSCRIPT', payload: text.trim()}, openerOrigin);
          window.close();
        }catch(err){
          alert('Kh√¥ng ƒë·ªçc ƒë∆∞·ª£c clipboard: ' + err.message + '\\nH√£y ƒë·∫£m b·∫£o b·∫°n v·ª´a sao ch√©p vƒÉn b·∫£n v√† c·∫•p quy·ªÅn clipboard cho trang.');
        }
      });
      document.getElementById('closeBtn').addEventListener('click', ()=> window.close());
      window.addEventListener('keydown', e=>{ if(e.key==='Escape') window.close(); });
    </script>
  </body></html>`;
  const popupUrl = URL.createObjectURL(new Blob([popupHtml], {type:'text/html'}));
  const w = 560, h = 420;
  const left = Math.round((window.screen.width - w)/2);
  const top = Math.round((window.screen.height - h)/3);
  window.open(popupUrl, 'gt_popup', `width=${w},height=${h},left=${left},top=${top}`);
}

window.addEventListener('message', (ev)=>{
  try{
    const {type, payload} = ev.data || {};
    if(type==='GT_TRANSCRIPT'){
      processSpokenText(String(payload||''));
    }
  }catch(_e){ /* ignore */ }
});

/* =====================
   LU·ªíNG LUY·ªÜN T·∫¨P
   ===================== */
function updateScore(){ scoreArea.textContent = 'ƒêi·ªÉm: ' + score; }
function updateDialogueDisplay(){
  const computerRole = userIsB ? 'A' : 'B';
  const userRole = userIsB ? 'B' : 'A';
  const computerText = userIsB ? linesA[currentLineIndex] : linesB[currentLineIndex];
  const userText = userIsB ? linesB[currentLineIndex] : linesA[currentLineIndex];
  document.getElementById('computer-line').textContent = `${computerRole} (M√°y): ${computerText || '...'}`;
  userLineEl.textContent = userText || '...';
  userLineTitle.textContent = `C√¢u c·ªßa b·∫°n (${userRole}):`;
  userLineEl.style.display = isUserLineVisible ? 'block' : 'none';
  toggleBtn.textContent = isUserLineVisible ? 'üôâ ·∫®n L·ªùi Tho·∫°i' : 'üôà Hi·ªán L·ªùi Tho·∫°i';
  swapRolesBtn.textContent = `üîÅ ƒê·ªïi Vai (Hi·ªán t·∫°i: B·∫°n l√† ${userRole})`;
}
function startPractice(){
  currentLineIndex=0; score=100; updateScore();
  document.getElementById('initial-setup').style.display='none';
  document.getElementById('review-area').style.display='none';
  practiceArea.style.display='block';
  toggleBtn.disabled = false;
  updateDialogueDisplay();
  statusArea.className='status neutral';
  statusArea.textContent='M√°y ƒëang n√≥i...';
  const next = userIsB ? linesA[0] : linesB[0];
  if(next){ speak(next, ()=> handleNextTurn()); } else { handleNextTurn(); }
}
function handleNextTurn(){
  const userText = userIsB ? linesB[currentLineIndex] : linesA[currentLineIndex];
  if(userText){
    statusArea.className='status neutral';
    statusArea.innerHTML = 'ƒê·∫øn l∆∞·ª£t b·∫°n. <b>M·ªü popup Google D·ªãch ƒë·ªÉ n√≥i</b>.';
    openTranslatePopup();
  }else{
    // N·∫øu l∆∞·ª£t n√†y r·ªóng, chuy·ªÉn ti·∫øp
    currentLineIndex++;
    const length = Math.max(linesA.length, linesB.length);
    if(currentLineIndex>=length){ return showReview(); }
    const next = userIsB ? linesA[currentLineIndex] : linesB[currentLineIndex];
    if(next){ speak(next, ()=> handleNextTurn()); } else { showReview(); }
  }
}

async function processSpokenText(spokenText){
  const targetText = userIsB ? (linesB[currentLineIndex]||'') : (linesA[currentLineIndex]||'');
  const {html, accuracy} = createDiffHtml(targetText, spokenText);
  // m·ªëc m·∫∑c ƒë·ªãnh: 90%
  const threshold = 90;
  if(accuracy >= threshold){
    statusArea.className='status success';
    statusArea.innerHTML = `T·ªët l·∫Øm! (ƒê·ªô ch√≠nh x√°c: ${accuracy}%)`;
    currentLineIndex++;
    const length = Math.max(linesA.length, linesB.length);
    if(currentLineIndex>=length){ return setTimeout(showReview, 600); }
    updateDialogueDisplay();
    const next = userIsB ? linesA[currentLineIndex] : linesB[currentLineIndex];
    if(next){
      statusArea.className='status neutral';
      statusArea.textContent='M√°y ƒëang n√≥i...';
      speak(next, ()=> handleNextTurn());
    }else{ handleNextTurn(); }
  }else{
    statusArea.className='status error';
    score = Math.max(0, score-5); updateScore();
    statusArea.innerHTML = `<div style="margin-bottom:8px;">Ch∆∞a ƒë·∫°t chu·∫©n (${accuracy}%). Th·ª≠ l·∫°i nh√©! (-5 ƒëi·ªÉm)</div><div class="feedback-box">${html}</div>`;
    // M·ªü l·∫°i popup cho b·∫°n n√≥i l·∫°i (ch·ªß ƒë·ªông)
    setTimeout(()=> openTranslatePopup(), 200);
  }
}

function showReview(){
  practiceArea.style.display='none';
  reviewArea.style.display='block';
  statusArea.className = score >= 80 ? 'status success' : 'status error';
  statusArea.textContent = score >= 80 ? `üéâ Ho√†n th√†nh! ƒêi·ªÉm: ${score}` : `üòÖ ƒêi·ªÉm: ${score}. H√£y luy·ªán th√™m nh√©!`;
  reviewContent.innerHTML = '';
  const userRole = userIsB ? 'B' : 'A';
  const length = Math.max(linesA.length, linesB.length);
  for(let i=0;i<length;i++){
    if(linesA[i]){
      const d = document.createElement('div');
      d.className='feedback-box';
      d.textContent = (userRole==='A'?'A (B·∫°n): ':'A (M√°y): ') + linesA[i];
      reviewContent.appendChild(d);
    }
    if(linesB[i]){
      const d = document.createElement('div');
      d.className='feedback-box';
      d.textContent = (userRole==='B'?'B (B·∫°n): ':'B (M√°y): ') + linesB[i];
      reviewContent.appendChild(d);
    }
  }
}

/* =====================
   S·ª∞ KI·ªÜN UI CH√çNH
   ===================== */
loadBtn.addEventListener('click', ()=>{
  const full = (dialogueInput.value||'').trim();
  if(!full){ alert('Vui l√≤ng nh·∫≠p h·ªôi tho·∫°i!'); return; }
  const lines = full.split('\n').filter(x=>x.trim()!=='');
  linesA=[]; linesB=[];
  lines.forEach(line=>{
    const l=line.trim();
    if(/^a:/i.test(l)) linesA.push(l.slice(2).trim());
    else if(/^b:/i.test(l)) linesB.push(l.slice(2).trim());
  });
  if(linesA.length===0 && linesB.length===0){ alert('Kh√¥ng t√¨m th·∫•y c√¢u tho·∫°i h·ª£p l·ªá (b·∫Øt ƒë·∫ßu b·∫±ng "A:" ho·∫∑c "B:")'); return; }
  startPractice();
});
swapRolesBtn.addEventListener('click', ()=>{
  userIsB = !userIsB;
  if(linesA.length||linesB.length){ startPractice(); } else { updateDialogueDisplay(); }
});
toggleBtn.addEventListener('click', ()=>{
  isUserLineVisible=!isUserLineVisible;
  userLineEl.style.display = isUserLineVisible ? 'block' : 'none';
  toggleBtn.textContent = isUserLineVisible ? 'üôâ ·∫®n L·ªùi Tho·∫°i' : 'üôà Hi·ªán L·ªùi Tho·∫°i';
});
restartSessionBtn.addEventListener('click', startPractice);
chooseNewBtn.addEventListener('click', ()=>{
  reviewArea.style.display='none';
  document.getElementById('initial-setup').style.display='block';
  practiceArea.style.display='none';
  statusArea.textContent='';
  statusArea.className='status neutral';
  score=100; updateScore();
});

/* =====================
   T·∫¢I DANH S√ÅCH H·ªòI THO·∫†I T·ª™ GITHUB (gi·ªØ nguy√™n t√≠nh nƒÉng)
   ===================== */
const owner='truongkhaai136-dot', repo='webtiengduc', baseFolderPath='hoi-thoai';
const conversationContainer = document.getElementById('danh-sach-hoi-thoai');
let fileList=[];

async function fetchAllFiles(path){
  const apiUrl = `https://api.github.com/repos/${owner}/${repo}/contents/${path}`;
  try{
    const res = await fetch(apiUrl);
    if(!res.ok) throw new Error('L·ªói m·∫°ng');
    const items = await res.json();
    const promises = items.map(async item=>{
      if(item.type==='dir') await fetchAllFiles(item.path);
      else if(item.type==='file' && item.name.endsWith('.txt')){
        fileList.push({ path:item.path, download_url:item.download_url });
      }
    });
    await Promise.all(promises);
  }catch(e){
    conversationContainer.innerHTML = '<p style="color:red;">L·ªói: Kh√¥ng th·ªÉ t·∫£i danh s√°ch h·ªôi tho·∫°i t·ª´ GitHub.</p>';
  }
}
function renderFileList(){
  if(!conversationContainer) return;
  conversationContainer.innerHTML = '<h2>Ch·ªçn m·ªôt h·ªôi tho·∫°i ƒë·ªÉ b·∫Øt ƒë·∫ßu:</h2>';
  fileList.sort((a,b)=>a.path.localeCompare(b.path));
  fileList.forEach(file=>{
    const btn = document.createElement('button');
    const prettyName = file.path.replace(baseFolderPath+'/','').replace('.txt','').replace(/\//g,' / ').replace(/_/g,' ').replace(/-/g,' ');
    btn.textContent = prettyName;
    btn.title = 'T·∫£i h·ªôi tho·∫°i: ' + prettyName;
    btn.className='file-button';
    btn.addEventListener('click', ()=>{
      document.querySelectorAll('.file-button').forEach(b=>b.disabled=true);
      btn.textContent='ƒêang t·∫£i...';
      fetch(file.download_url).then(r=>r.text()).then(content=>{
        dialogueInput.value = content;
        btn.textContent='ƒê√£ t·∫£i!'; btn.style.background='#198754';
        setTimeout(()=>{
          document.querySelectorAll('.file-button').forEach(b=>{ b.disabled=false; b.style.background=''; b.textContent = b.textContent.includes('ƒê√£ t·∫£i!')? prettyName : b.textContent; });
        }, 1200);
      }).catch(_e=>{
        btn.textContent='T·∫£i l·ªói!'; btn.style.background='#dc3545';
      });
    });
    conversationContainer.appendChild(btn);
  });
}
if(conversationContainer){
  fetchAllFiles(baseFolderPath).then(renderFileList);
}
</script>
</body>
</html>
