<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Luyá»‡n NÃ³i Tiáº¿ng Äá»©c Pro â€” Popup Google Dá»‹ch</title>
  <style>
    :root { --primary:#0d6efd; --accent:#ffc107; --ok:#198754; --error:#dc3545; }
    *{ box-sizing:border-box }
    body{
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background:#f0f2f5; color:#1c1e21; margin:0; padding:24px;
      display:flex; justify-content:center; align-items:flex-start; min-height:100vh;
    }
    .container{
      width:100%; max-width:760px; background:#fff; border-radius:14px; padding:28px;
      box-shadow:0 6px 18px rgba(0,0,0,.08);
    }
    h1{ margin:0 0 16px; color:var(--primary); }
    h2{ font-size:1.1rem; color:#495057; margin:22px 0 8px; border-bottom:1px solid #e9ecef; padding-bottom:6px;}
    textarea{
      width:100%; padding:12px; border:1px solid #ced4da; border-radius:10px; font-size:1rem; resize:vertical;
    }
    .controls,.session-controls{ display:flex; gap:10px; flex-wrap:wrap; margin:14px 0; }
    button{
      border:0; background:var(--primary); color:#fff; padding:10px 18px; border-radius:9px;
      font-weight:600; cursor:pointer; transition:.2s; box-shadow:0 2px 5px rgba(0,0,0,.08);
    }
    button:hover{ transform:translateY(-1px); filter:brightness(0.95); }
    button.secondary{ background:#6c757d; }
    button.success{ background:var(--ok); }
    button.warning{ background:#fd7e14; }
    button.info{ background:#0dcaf0; }
    button.ghost{ background:#e9ecef; color:#333; }
    button:disabled{ opacity:.6; cursor:not-allowed; transform:none; }
    .dialogue-box{ background:#f8f9fa; border:1px solid #e9ecef; border-radius:10px; padding:14px; }
    .line{ padding:10px; margin:8px 0; border-radius:10px; font-size:1.05rem; }
    .computer-line{ background:#e7f3ff; }
    .user-line{ background:#fff3cd; font-weight:600; border:2px dashed var(--accent); }
    .status{ margin-top:14px; font-weight:700; padding:12px; border-radius:10px; min-height:48px; }
    .status.success{ background:#d1e7dd; color:#146c43; }
    .status.error{ background:#f8d7da; color:#b02a37; }
    .status.neutral{ background:#eef; color:#334; }
    .instructions{ background:#eef; padding:14px; border-radius:10px; border-left:4px solid var(--primary); color:#555; }
    .feedback-box{
      font-size:1rem; background:#f8f9fa; border:1px solid #ddd; border-radius:10px; padding:14px; line-height:1.7; margin-top:10px;
    }
    .diff-correct{ color:#000; }
    .diff-incorrect{ color:#dc3545; font-weight:700; text-decoration:underline; }
    .diff-missing{ color:#6c757d; font-style:italic; }
    #score-area{
      position:fixed; top:18px; right:18px; background:var(--accent); color:#333;
      padding:8px 14px; border-radius:20px; font-weight:800; box-shadow:0 2px 6px rgba(0,0,0,.12);
    }
    #danh-sach-hoi-thoai{ text-align:left; background:#f8f9fa; border:1px solid #dee2e6; border-radius:10px; padding:16px; margin-bottom:18px; }
    .file-button{ background:var(--primary); padding:8px 13px; border-radius:8px; color:#fff; margin:4px; font-size:.95rem; }
  </style>
</head>
<body>
<div id="score-area">Äiá»ƒm: 100</div>
<div class="container">
  <h1>Luyá»‡n Giao Tiáº¿p ChuyÃªn Nghiá»‡p ğŸš€</h1>

  <div id="danh-sach-hoi-thoai"></div>

  <div id="initial-setup">
    <div class="instructions">
      <b>HÆ°á»›ng dáº«n:</b>
      <ol>
        <li>Chá»n há»™i thoáº¡i cÃ³ sáºµn hoáº·c dÃ¡n há»™i thoáº¡i cá»§a báº¡n vÃ o Ã´ bÃªn dÆ°á»›i (dÃ²ng pháº£i báº¯t Ä‘áº§u báº±ng <code>A:</code> hoáº·c <code>B:</code>).</li>
        <li>Nháº¥n <b>Báº¯t Äáº§u Luyá»‡n Táº­p</b>. Khi Ä‘áº¿n lÆ°á»£t báº¡n, há»‡ thá»‘ng má»Ÿ <b>popup Google Dá»‹ch (Äá»©c â†’ Viá»‡t)</b>.</li>
        <li>Trong popup, báº¥m <b>Má»Ÿ Google Dá»‹ch</b> â†’ nháº¥n biá»ƒu tÆ°á»£ng <b>micro</b> vÃ  nÃ³i.</li>
        <li>Sao chÃ©p Ä‘oáº¡n tiáº¿ng Äá»©c báº¡n vá»«a nÃ³i (Ã´ bÃªn trÃ¡i cá»§a Google Dá»‹ch) â†’ quay láº¡i popup, báº¥m <b>Láº¥y tá»« Clipboard & Gá»­i</b> Ä‘á»ƒ cháº¥m Ä‘iá»ƒm tá»± Ä‘á»™ng.</li>
      </ol>
      <div style="margin-top:8px; font-size:.95rem; color:#6c757d">
        *Do giá»›i háº¡n báº£o máº­t trÃ¬nh duyá»‡t, trang khÃ´ng thá»ƒ Ä‘á»c trá»±c tiáº¿p ná»™i dung trÃªn translate.google.com, nÃªn cáº§n má»™t cÃº nháº¥p Ä‘á»ƒ láº¥y tá»« Clipboard.
      </div>
    </div>

    <textarea id="dialogue-input" rows="6" placeholder="DÃ¡n há»™i thoáº¡i á»Ÿ Ä‘Ã¢y...
VÃ­ dá»¥:
A: Hallo, wie geht's?
B: Mir geht's gut, danke."></textarea>

    <div class="controls">
      <button id="load-btn">ğŸš€ Báº¯t Äáº§u Luyá»‡n Táº­p</button>
      <button id="swap-roles-btn" class="ghost">ğŸ” Äá»•i Vai (Hiá»‡n táº¡i: Báº¡n lÃ  B)</button>
      <button id="toggle-line-btn" class="ghost" disabled>ğŸ™ˆ Hiá»‡n Lá»i Thoáº¡i</button>
    </div>
  </div>

  <div id="practice-area" class="dialogue-box" style="display:none;">
    <h2>Lá»i thoáº¡i cá»§a mÃ¡y:</h2>
    <div id="computer-line" class="line computer-line">...</div>
    <div>
      <h2 id="user-line-title">CÃ¢u cá»§a báº¡n:</h2>
      <div id="user-line" class="line user-line" style="display:none;">...</div>
    </div>
  </div>

  <div id="status-area" class="status neutral"></div>

  <div id="review-area" style="display:none;">
    <h2>Xem Láº¡i Há»™i Thoáº¡i</h2>
    <div id="review-content"></div>
    <div class="controls" style="margin-top: 10px;">
      <button id="restart-session-btn" class="success">ğŸ” Luyá»‡n láº¡i há»™i thoáº¡i nÃ y</button>
      <button id="choose-new-btn" class="secondary">ğŸ  Chá»n há»™i thoáº¡i khÃ¡c</button>
    </div>
  </div>
</div>

<script>
/* =====================
   TIá»†N ÃCH & CHáº¤M ÄIá»‚M
   ===================== */
function lcs(seq1, seq2){
  const m=seq1.length,n=seq2.length;
  const dp=Array.from({length:m+1},()=>Array(n+1).fill(0));
  for(let i=1;i<=m;i++){
    for(let j=1;j<=n;j++){
      dp[i][j]=seq1[i-1]===seq2[j-1]?dp[i-1][j-1]+1:Math.max(dp[i-1][j],dp[i][j-1]);
    }
  }
  let i=m,j=n,res=[];
  while(i>0&&j>0){
    if(seq1[i-1]===seq2[j-1]){ res.unshift(seq1[i-1]); i--; j--; }
    else if(dp[i-1][j]>dp[i][j-1]) i--; else j--;
  }
  return res;
}
function createDiffHtml(originalText, spokenText){
  const clean=t=>t.toLowerCase().replace(/[^\w\s'Ã¤Ã¶Ã¼ÃŸ]/g,'').split(/\s+/).filter(Boolean);
  const original=clean(originalText), spoken=clean(spokenText);
  const common=new Set(lcs(original,spoken));
  let correct=0;
  const spokenHtml=spoken.map(w=>{
    if(common.has(w)){ correct++; return `<span class="diff-correct">${w}</span>`; }
    return `<span class="diff-incorrect">${w}</span>`;
  }).join(' ');
  const originalHtml=original.map(w=> common.has(w) ? `<span class="diff-correct">${w}</span>` : `<span class="diff-missing">${w}</span>`).join(' ');
  const accuracy = original.length ? Math.round((correct/original.length)*100) : 0;
  return { html:`<div><b>CÃ¢u gá»‘c:</b> ${originalHtml}</div><div><b>Báº¡n nÃ³i:</b> ${spokenHtml}</div>`, accuracy };
}

/* =====================
   BIáº¾N TRáº NG THÃI & UI
   ===================== */
const scoreArea = document.getElementById('score-area');
const statusArea = document.getElementById('status-area');
const dialogueInput = document.getElementById('dialogue-input');
const loadBtn = document.getElementById('load-btn');
const swapRolesBtn = document.getElementById('swap-roles-btn');
const toggleBtn = document.getElementById('toggle-line-btn');

const practiceArea = document.getElementById('practice-area');
const computerLineEl = document.getElementById('computer-line');
const userLineEl = document.getElementById('user-line');
const userLineTitle = document.getElementById('user-line-title');

const reviewArea = document.getElementById('review-area');
const reviewContent = document.getElementById('review-content');
const restartSessionBtn = document.getElementById('restart-session-btn');
const chooseNewBtn = document.getElementById('choose-new-btn');

let linesA=[], linesB=[], currentLineIndex=0, userIsB=true, isUserLineVisible=false;
let score=100;

/* =====================
   GIá»ŒNG Äá»ŒC (mÃ¡y nÃ³i)
   ===================== */
const synth = window.speechSynthesis;
let voices=[];
function loadVoices(){ voices = synth.getVoices(); }
loadVoices(); if(synth.onvoiceschanged !== undefined){ synth.onvoiceschanged = loadVoices; }
function speak(text, cb){
  if(synth.speaking) synth.cancel();
  const u = new SpeechSynthesisUtterance(text);
  u.voice = voices.find(v=>v.name==='Microsoft Amala Online (Natural) - German (Germany)') || voices.find(v=>v.lang?.startsWith('de'));
  u.onend = ()=> cb && cb();
  synth.speak(u);
}

/* =====================
   GOOGLE Dá»ŠCH POPUP
   - KhÃ´ng dÃ¹ng SpeechRecognition
   - DÃ¹ng window.open + postMessage + Clipboard
   ===================== */
function openTranslatePopup(){
  const popupHtml = `<!doctype html>
  <html lang="vi"><head><meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Google Dá»‹ch (Äá»©c â†’ Viá»‡t)</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;margin:0;padding:16px;background:#f7f7fb;color:#222}
    .box{background:#fff;border:1px solid #e5e7eb;border-radius:12px;max-width:560px;margin:0 auto;padding:16px;box-shadow:0 4px 14px rgba(0,0,0,.06)}
    h1{font-size:1.1rem;margin:0 0 8px;color:#0d6efd}
    p{margin:8px 0}
    .row{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    button,a.btn{background:#0d6efd;color:#fff;border:0;border-radius:10px;padding:10px 14px;font-weight:700;text-decoration:none;display:inline-block}
    button.secondary{background:#6c757d}
    .tip{font-size:.9rem;color:#555;background:#eef;padding:10px;border-radius:8px;margin-top:10px}
  </style></head>
  <body>
    <div class="box">
      <h1>Google Dá»‹ch â€” Nháº­n Transcript (DE â†’ VI)</h1>
      <p>1) Nháº¥n <b>Má»Ÿ Google Dá»‹ch</b> â†’ báº¥m biá»ƒu tÆ°á»£ng <b>micro</b> vÃ  nÃ³i báº±ng tiáº¿ng Äá»©c.</p>
      <p>2) Chá»n & Sao chÃ©p Ä‘oáº¡n tiáº¿ng Äá»©c vá»«a nÃ³i (Ã´ bÃªn trÃ¡i).</p>
      <p>3) Quay láº¡i cá»­a sá»• nÃ y vÃ  báº¥m <b>Láº¥y tá»« Clipboard & Gá»­i</b>.</p>
      <div class="row">
        <a class="btn" target="_blank" rel="noopener" href="https://translate.google.com/?sl=de&tl=vi&op=translate">ğŸŒ Má»Ÿ Google Dá»‹ch</a>
        <button id="pasteSendBtn">ğŸ“‹ Láº¥y tá»« Clipboard & Gá»­i</button>
        <button id="closeBtn" class="secondary">ÄÃ³ng</button>
      </div>
      <div class="tip">Máº¹o: Nháº¥n <b>Ctrl/Cmd + C</b> báº£n tiáº¿ng Äá»©c xong hÃ£y quay láº¡i Ä‘Ã¢y.</div>
    </div>
    <script>
      const openerOrigin = "*"; // CÃ³ thá»ƒ Ä‘á»•i sang origin cá»¥ thá»ƒ náº¿u báº¡n cháº¡y trÃªn web server.
      document.getElementById('pasteSendBtn').addEventListener('click', async () => {
        try{
          const text = await navigator.clipboard.readText();
          if(!text || !text.trim()){ alert('Clipboard trá»‘ng. HÃ£y sao chÃ©p Ä‘oáº¡n TIáº¾NG Äá»¨C á»Ÿ Ã´ trÃ¡i cá»§a Google Dá»‹ch trÆ°á»›c.'); return; }
          window.opener && window.opener.postMessage({type:'GT_TRANSCRIPT', payload: text.trim()}, openerOrigin);
          window.close();
        }catch(err){
          alert('KhÃ´ng Ä‘á»c Ä‘Æ°á»£c clipboard: ' + err.message + '\\nHÃ£y Ä‘áº£m báº£o báº¡n vá»«a sao chÃ©p vÄƒn báº£n vÃ  cáº¥p quyá»n clipboard cho trang.');
        }
      });
      document.getElementById('closeBtn').addEventListener('click', ()=> window.close());
      window.addEventListener('keydown', e=>{ if(e.key==='Escape') window.close(); });
    </script>
  </body></html>`;
  const popupUrl = URL.createObjectURL(new Blob([popupHtml], {type:'text/html'}));
  const w = 560, h = 420;
  const left = Math.round((window.screen.width - w)/2);
  const top = Math.round((window.screen.height - h)/3);
  window.open(popupUrl, 'gt_popup', `width=${w},height=${h},left=${left},top=${top}`);
}

window.addEventListener('message', (ev)=>{
  try{
    const {type, payload} = ev.data || {};
    if(type==='GT_TRANSCRIPT'){
      processSpokenText(String(payload||''));
    }
  }catch(_e){ /* ignore */ }
});

/* =====================
   LUá»’NG LUYá»†N Táº¬P
   ===================== */
function updateScore(){ scoreArea.textContent = 'Äiá»ƒm: ' + score; }
function updateDialogueDisplay(){
  const computerRole = userIsB ? 'A' : 'B';
  const userRole = userIsB ? 'B' : 'A';
  const computerText = userIsB ? linesA[currentLineIndex] : linesB[currentLineIndex];
  const userText = userIsB ? linesB[currentLineIndex] : linesA[currentLineIndex];
  document.getElementById('computer-line').textContent = `${computerRole} (MÃ¡y): ${computerText || '...'}`;
  userLineEl.textContent = userText || '...';
  userLineTitle.textContent = `CÃ¢u cá»§a báº¡n (${userRole}):`;
  userLineEl.style.display = isUserLineVisible ? 'block' : 'none';
  toggleBtn.textContent = isUserLineVisible ? 'ğŸ™‰ áº¨n Lá»i Thoáº¡i' : 'ğŸ™ˆ Hiá»‡n Lá»i Thoáº¡i';
  swapRolesBtn.textContent = `ğŸ” Äá»•i Vai (Hiá»‡n táº¡i: Báº¡n lÃ  ${userRole})`;
}
function startPractice(){
  currentLineIndex=0; score=100; updateScore();
  document.getElementById('initial-setup').style.display='none';
  document.getElementById('review-area').style.display='none';
  practiceArea.style.display='block';
  toggleBtn.disabled = false;
  updateDialogueDisplay();
  statusArea.className='status neutral';
  statusArea.textContent='MÃ¡y Ä‘ang nÃ³i...';
  const next = userIsB ? linesA[0] : linesB[0];
  if(next){ speak(next, ()=> handleNextTurn()); } else { handleNextTurn(); }
}
function handleNextTurn(){
  const userText = userIsB ? linesB[currentLineIndex] : linesA[currentLineIndex];
  if(userText){
    statusArea.className='status neutral';
    statusArea.innerHTML = 'Äáº¿n lÆ°á»£t báº¡n. <b>Má»Ÿ popup Google Dá»‹ch Ä‘á»ƒ nÃ³i</b>.';
    openTranslatePopup();
  }else{
    // Náº¿u lÆ°á»£t nÃ y rá»—ng, chuyá»ƒn tiáº¿p
    currentLineIndex++;
    const length = Math.max(linesA.length, linesB.length);
    if(currentLineIndex>=length){ return showReview(); }
    const next = userIsB ? linesA[currentLineIndex] : linesB[currentLineIndex];
    if(next){ speak(next, ()=> handleNextTurn()); } else { showReview(); }
  }
}

async function processSpokenText(spokenText){
  const targetText = userIsB ? (linesB[currentLineIndex]||'') : (linesA[currentLineIndex]||'');
  const {html, accuracy} = createDiffHtml(targetText, spokenText);
  // má»‘c máº·c Ä‘á»‹nh: 90%
  const threshold = 90;
  if(accuracy >= threshold){
    statusArea.className='status success';
    statusArea.innerHTML = `Tá»‘t láº¯m! (Äá»™ chÃ­nh xÃ¡c: ${accuracy}%)`;
    currentLineIndex++;
    const length = Math.max(linesA.length, linesB.length);
    if(currentLineIndex>=length){ return setTimeout(showReview, 600); }
    updateDialogueDisplay();
    const next = userIsB ? linesA[currentLineIndex] : linesB[currentLineIndex];
    if(next){
      statusArea.className='status neutral';
      statusArea.textContent='MÃ¡y Ä‘ang nÃ³i...';
      speak(next, ()=> handleNextTurn());
    }else{ handleNextTurn(); }
  }else{
    statusArea.className='status error';
    score = Math.max(0, score-5); updateScore();
    statusArea.innerHTML = `<div style="margin-bottom:8px;">ChÆ°a Ä‘áº¡t chuáº©n (${accuracy}%). Thá»­ láº¡i nhÃ©! (-5 Ä‘iá»ƒm)</div><div class="feedback-box">${html}</div>`;
    // Má»Ÿ láº¡i popup cho báº¡n nÃ³i láº¡i (chá»§ Ä‘á»™ng)
    setTimeout(()=> openTranslatePopup(), 200);
  }
}

function showReview(){
  practiceArea.style.display='none';
  reviewArea.style.display='block';
  statusArea.className = score >= 80 ? 'status success' : 'status error';
  statusArea.textContent = score >= 80 ? `ğŸ‰ HoÃ n thÃ nh! Äiá»ƒm: ${score}` : `ğŸ˜… Äiá»ƒm: ${score}. HÃ£y luyá»‡n thÃªm nhÃ©!`;
  reviewContent.innerHTML = '';
  const userRole = userIsB ? 'B' : 'A';
  const length = Math.max(linesA.length, linesB.length);
  for(let i=0;i<length;i++){
    if(linesA[i]){
      const d = document.createElement('div');
      d.className='feedback-box';
      d.textContent = (userRole==='A'?'A (Báº¡n): ':'A (MÃ¡y): ') + linesA[i];
      reviewContent.appendChild(d);
    }
    if(linesB[i]){
      const d = document.createElement('div');
      d.className='feedback-box';
      d.textContent = (userRole==='B'?'B (Báº¡n): ':'B (MÃ¡y): ') + linesB[i];
      reviewContent.appendChild(d);
    }
  }
}

/* =====================
   Sá»° KIá»†N UI CHÃNH
   ===================== */
loadBtn.addEventListener('click', ()=>{
  const full = (dialogueInput.value||'').trim();
  if(!full){ alert('Vui lÃ²ng nháº­p há»™i thoáº¡i!'); return; }
  const lines = full.split('\n').filter(x=>x.trim()!=='');
  linesA=[]; linesB=[];
  lines.forEach(line=>{
    const l=line.trim();
    if(/^a:/i.test(l)) linesA.push(l.slice(2).trim());
    else if(/^b:/i.test(l)) linesB.push(l.slice(2).trim());
  });
  if(linesA.length===0 && linesB.length===0){ alert('KhÃ´ng tÃ¬m tháº¥y cÃ¢u thoáº¡i há»£p lá»‡ (báº¯t Ä‘áº§u báº±ng "A:" hoáº·c "B:")'); return; }
  startPractice();
});
swapRolesBtn.addEventListener('click', ()=>{
  userIsB = !userIsB;
  if(linesA.length||linesB.length){ startPractice(); } else { updateDialogueDisplay(); }
});
toggleBtn.addEventListener('click', ()=>{
  isUserLineVisible=!isUserLineVisible;
  userLineEl.style.display = isUserLineVisible ? 'block' : 'none';
  toggleBtn.textContent = isUserLineVisible ? 'ğŸ™‰ áº¨n Lá»i Thoáº¡i' : 'ğŸ™ˆ Hiá»‡n Lá»i Thoáº¡i';
});
restartSessionBtn.addEventListener('click', startPractice);
chooseNewBtn.addEventListener('click', ()=>{
  reviewArea.style.display='none';
  document.getElementById('initial-setup').style.display='block';
  practiceArea.style.display='none';
  statusArea.textContent='';
  statusArea.className='status neutral';
  score=100; updateScore();
});

/* =====================
   Táº¢I DANH SÃCH Há»˜I THOáº I Tá»ª GITHUB (giá»¯ nguyÃªn tÃ­nh nÄƒng)
   ===================== */
const owner='truongkhaai136-dot', repo='webtiengduc', baseFolderPath='hoi-thoai';
const conversationContainer = document.getElementById('danh-sach-hoi-thoai');
let fileList=[];

async function fetchAllFiles(path){
  const apiUrl = `https://api.github.com/repos/${owner}/${repo}/contents/${path}`;
  try{
    const res = await fetch(apiUrl);
    if(!res.ok) throw new Error('Lá»—i máº¡ng');
    const items = await res.json();
    const promises = items.map(async item=>{
      if(item.type==='dir') await fetchAllFiles(item.path);
      else if(item.type==='file' && item.name.endsWith('.txt')){
        fileList.push({ path:item.path, download_url:item.download_url });
      }
    });
    await Promise.all(promises);
  }catch(e){
    conversationContainer.innerHTML = '<p style="color:red;">Lá»—i: KhÃ´ng thá»ƒ táº£i danh sÃ¡ch há»™i thoáº¡i tá»« GitHub.</p>';
  }
}
function renderFileList(){
  if(!conversationContainer) return;
  conversationContainer.innerHTML = '<h2>Chá»n má»™t há»™i thoáº¡i Ä‘á»ƒ báº¯t Ä‘áº§u:</h2>';
  fileList.sort((a,b)=>a.path.localeCompare(b.path));
  fileList.forEach(file=>{
    const btn = document.createElement('button');
    const prettyName = file.path.replace(baseFolderPath+'/','').replace('.txt','').replace(/\//g,' / ').replace(/_/g,' ').replace(/-/g,' ');
    btn.textContent = prettyName;
    btn.title = 'Táº£i há»™i thoáº¡i: ' + prettyName;
    btn.className='file-button';
    btn.addEventListener('click', ()=>{
      document.querySelectorAll('.file-button').forEach(b=>b.disabled=true);
      btn.textContent='Äang táº£i...';
      fetch(file.download_url).then(r=>r.text()).then(content=>{
        dialogueInput.value = content;
        btn.textContent='ÄÃ£ táº£i!'; btn.style.background='#198754';
        setTimeout(()=>{
          document.querySelectorAll('.file-button').forEach(b=>{ b.disabled=false; b.style.background=''; b.textContent = b.textContent.includes('ÄÃ£ táº£i!')? prettyName : b.textContent; });
        }, 1200);
      }).catch(_e=>{
        btn.textContent='Táº£i lá»—i!'; btn.style.background='#dc3545';
      });
    });
    conversationContainer.appendChild(btn);
  });
}
if(conversationContainer){
  fetchAllFiles(baseFolderPath).then(renderFileList);
}
</script>
</body>
</html>
